CREATE TABLE public.nsi_country (
	id int4 NOT NULL,
	short_name varchar(128) NULL, -- Краткое наименование страны
	country_code varchar(3) NOT NULL, -- Код страны
	full_name varchar(128) NULL, -- Полное наименование страны
	codea2 varchar(2) NULL, -- Код ЕА2
	codea3 varchar(3) NULL, -- Код ЕА3
	CONSTRAINT nsi_country_pk PRIMARY KEY (country_code)
);
COMMENT ON TABLE public.nsi_country IS 'Справочник (классификатор) стран мира';

-- Column comments

COMMENT ON COLUMN public.nsi_country.short_name IS 'Краткое наименование страны';
COMMENT ON COLUMN public.nsi_country.country_code IS 'Код страны';
COMMENT ON COLUMN public.nsi_country.full_name IS 'Полное наименование страны';
COMMENT ON COLUMN public.nsi_country.codea2 IS 'Код ЕА2';
COMMENT ON COLUMN public.nsi_country.codea3 IS 'Код ЕА3';


CREATE TABLE public.nsi_okrugs (
	okrug_id int4 NOT NULL, -- Идентификатор округа
	okrug_name varchar(510) NULL, -- Наименование округа
	CONSTRAINT nsi_okrugs_pk PRIMARY KEY (okrug_id)
);
COMMENT ON TABLE public.nsi_okrugs IS 'Справочник федеральных округов Российской Федерации';

-- Column comments

COMMENT ON COLUMN public.nsi_okrugs.okrug_id IS 'Идентификатор округа';
COMMENT ON COLUMN public.nsi_okrugs.okrug_name IS 'Наименование округа';


CREATE TABLE public.nsi_product_types (
	"CodeVid_egais" varchar(5) NOT NULL, -- Код продукции в ЕГАИС
	"GroupProduct" varchar(50) NULL, -- Группа продукции
	"Vid_Description" varchar(500) NULL, -- Название вида продукции
	"CodeVid_TNVED" varchar(4000) NULL, -- Код ТНВЭД
	"CodeVid_classifier" varchar(50) NULL, -- Код ОКПД2
	"ProductType_Code" varchar(3) NULL, -- Код продукции в ЕГАИС
	CONSTRAINT nsi_product_types_pk PRIMARY KEY ("CodeVid_egais")
);
COMMENT ON TABLE public.nsi_product_types IS 'Справочник видов продукции, совмещенный с классификатором ОКПД2';

-- Column comments

COMMENT ON COLUMN public.nsi_product_types."CodeVid_egais" IS 'Код продукции в ЕГАИС';
COMMENT ON COLUMN public.nsi_product_types."GroupProduct" IS 'Группа продукции';
COMMENT ON COLUMN public.nsi_product_types."Vid_Description" IS 'Название вида продукции';
COMMENT ON COLUMN public.nsi_product_types."CodeVid_TNVED" IS 'Код ТНВЭД';
COMMENT ON COLUMN public.nsi_product_types."CodeVid_classifier" IS 'Код ОКПД2';
COMMENT ON COLUMN public.nsi_product_types."ProductType_Code" IS 'Код продукции в ЕГАИС';


CREATE TABLE public.nsi_regions (
	"regionCode" varchar(2) NOT NULL, -- Код субъекта
	"timeZone" int4 NOT NULL, -- Временная зона
	okrug_id int4 NULL, -- Код округа РФ
	"regionName" varchar(500) NULL, -- Наименование субъекта
	"isActive" bool NULL, -- Признак активной записи справочника
	CONSTRAINT nsi_regions_pk PRIMARY KEY ("regionCode"),
	CONSTRAINT nsi_regions_nsi_okrugs_fk FOREIGN KEY (okrug_id) REFERENCES public.nsi_okrugs(okrug_id)
);
COMMENT ON TABLE public.nsi_regions IS 'Справочник субъектов Российской Федерации (регионов)';

-- Column comments

COMMENT ON COLUMN public.nsi_regions."regionCode" IS 'Код субъекта';
COMMENT ON COLUMN public.nsi_regions."timeZone" IS 'Временная зона';
COMMENT ON COLUMN public.nsi_regions.okrug_id IS 'Код округа РФ';
COMMENT ON COLUMN public.nsi_regions."regionName" IS 'Наименование субъекта';
COMMENT ON COLUMN public.nsi_regions."isActive" IS 'Признак активной записи справочника';

-- Foreign key comments

COMMENT ON CONSTRAINT nsi_regions_nsi_okrugs_fk ON public.nsi_regions IS 'Ссылка на Федеральный округ РФ';


CREATE TABLE public.nsi_clients (
	full_name varchar(510) NULL, -- Полное наименование
	country_code varchar(3) NULL, -- Код страны
	islicense bool NULL, -- Признак наличия лицензии
	status_id varchar(50) NULL, -- Текущий статус (Active/Deleted)
	short_name varchar(128) NULL, -- Краткое наименование
	region_code varchar(2) NULL, -- Код региона РФ
	inn varchar(12) NULL, -- ИНН
	owner_id varchar(50) NOT NULL, -- Код организации в ЕГАИС (СИО)
	dejure_address varchar(510) NULL, -- Юридичекский адрес
	kpp varchar(9) NULL, -- КПП по месту деятельности
	fact_address varchar(4000) NULL, -- Фактический адрес осуществления деятельности
	CONSTRAINT nsi_clients_pk PRIMARY KEY (owner_id),
	CONSTRAINT nsi_clients_nsi_country_fk FOREIGN KEY (country_code) REFERENCES public.nsi_country(country_code),
	CONSTRAINT nsi_clients_nsi_regions_fk FOREIGN KEY (region_code) REFERENCES public.nsi_regions("regionCode")
);
COMMENT ON TABLE public.nsi_clients IS 'Справочник организаций ЕГАИС';

-- Column comments

COMMENT ON COLUMN public.nsi_clients.full_name IS 'Полное наименование';
COMMENT ON COLUMN public.nsi_clients.country_code IS 'Код страны';
COMMENT ON COLUMN public.nsi_clients.islicense IS 'Признак наличия лицензии';
COMMENT ON COLUMN public.nsi_clients.status_id IS 'Текущий статус (Active/Deleted)';
COMMENT ON COLUMN public.nsi_clients.short_name IS 'Краткое наименование';
COMMENT ON COLUMN public.nsi_clients.region_code IS 'Код региона РФ';
COMMENT ON COLUMN public.nsi_clients.inn IS 'ИНН';
COMMENT ON COLUMN public.nsi_clients.owner_id IS 'Код организации в ЕГАИС (СИО)';
COMMENT ON COLUMN public.nsi_clients.dejure_address IS 'Юридичекский адрес';
COMMENT ON COLUMN public.nsi_clients.kpp IS 'КПП по месту деятельности';
COMMENT ON COLUMN public.nsi_clients.fact_address IS 'Фактический адрес осуществления деятельности';


CREATE TABLE public.nsi_products (
	alc_code int8 NOT NULL, -- Код продукции ЕГАИС (АЛКОКОД)
	alcpercmin numeric(18, 3) NULL, -- Минимальная крепость
	country_code varchar(3) NULL, -- Код страны производства
	brand varchar(510) NULL, -- Название брэнда
	shelflife int8 NULL, -- Срок годности в днях
	owner_id varchar(50) NULL, -- Код организации производителя
	alcpercmax numeric(18, 3) NULL, -- Максимальная крепость
	package_type_code varchar(5) NULL, -- Код упаковки
	isunpacked bool NOT NULL, -- Признак фаовки в потребительскую тару
	alc_name_full varchar(510) NULL, -- Полное наименование
	capacity numeric(18, 4) NULL, -- Емкость тары
	alcperc numeric(18, 3) NULL, -- Средняя или фактическая крепость
	productvid_code varchar(10) NULL, -- Тип продукции
	product_code varchar(5) NULL, -- Код вида
	importer_ownerid varchar(50) NULL, -- Код организации - импортера продукции в РФ
	CONSTRAINT nsi_products_pk PRIMARY KEY (alc_code),
	CONSTRAINT nsi_products_nsi_clients_fk FOREIGN KEY (owner_id) REFERENCES public.nsi_clients(owner_id),
	CONSTRAINT nsi_products_nsi_clients_importer_fk FOREIGN KEY (importer_ownerid) REFERENCES public.nsi_clients(owner_id),
	CONSTRAINT nsi_products_nsi_country_fk FOREIGN KEY (country_code) REFERENCES public.nsi_country(country_code),
	CONSTRAINT nsi_products_nsi_product_types_fk FOREIGN KEY (product_code) REFERENCES public.nsi_product_types("CodeVid_egais")
);
CREATE INDEX nsi_products_owner_id_idx ON public.nsi_products USING btree (owner_id);
COMMENT ON TABLE public.nsi_products IS 'Справочник продукции ЕГАИС';

-- Column comments

COMMENT ON COLUMN public.nsi_products.alc_code IS 'Код продукции ЕГАИС (АЛКОКОД)';
COMMENT ON COLUMN public.nsi_products.alcpercmin IS 'Минимальная крепость';
COMMENT ON COLUMN public.nsi_products.country_code IS 'Код страны производства';
COMMENT ON COLUMN public.nsi_products.brand IS 'Название брэнда';
COMMENT ON COLUMN public.nsi_products.shelflife IS 'Срок годности в днях';
COMMENT ON COLUMN public.nsi_products.owner_id IS 'Код организации производителя';
COMMENT ON COLUMN public.nsi_products.alcpercmax IS 'Максимальная крепость';
COMMENT ON COLUMN public.nsi_products.package_type_code IS 'Код упаковки';
COMMENT ON COLUMN public.nsi_products.isunpacked IS 'Признак фаовки в потребительскую тару';
COMMENT ON COLUMN public.nsi_products.alc_name_full IS 'Полное наименование';
COMMENT ON COLUMN public.nsi_products.capacity IS 'Емкость тары';
COMMENT ON COLUMN public.nsi_products.alcperc IS 'Средняя или фактическая крепость';
COMMENT ON COLUMN public.nsi_products.productvid_code IS 'Тип продукции';
COMMENT ON COLUMN public.nsi_products.product_code IS 'Код вида';
COMMENT ON COLUMN public.nsi_products.importer_ownerid IS 'Код организации - импортера продукции в РФ';

-- Foreign key comments

COMMENT ON CONSTRAINT nsi_products_nsi_clients_fk ON public.nsi_products IS 'Производитель продукции';
COMMENT ON CONSTRAINT nsi_products_nsi_clients_importer_fk ON public.nsi_products IS 'Импортер продукции в РФ';
COMMENT ON CONSTRAINT nsi_products_nsi_country_fk ON public.nsi_products IS 'Страна производства';
COMMENT ON CONSTRAINT nsi_products_nsi_product_types_fk ON public.nsi_products IS 'Вид продукции';


CREATE TABLE public.data_production (
	owner_id varchar(50) NULL, -- Код организации - производителя в  ЕГАИС (СИО)
	produceddate date NULL, -- Дата производства
	alc_code int8 NULL, -- Код продукции
	vbs numeric(18, 4) NULL, -- Объем в дал. в безводном спирте
	volume_dal numeric(18, 4) NULL, -- Объем в дал
	bottlecount numeric(18) NULL, -- Количество бутылок
	CONSTRAINT data_production_nsi_clients_fk FOREIGN KEY (owner_id) REFERENCES public.nsi_clients(owner_id),
	CONSTRAINT data_production_nsi_products_fk FOREIGN KEY (alc_code) REFERENCES public.nsi_products(alc_code)
);
COMMENT ON TABLE public.data_production IS 'Данные о производстве продукции';

-- Column comments

COMMENT ON COLUMN public.data_production.owner_id IS 'Код организации - производителя в  ЕГАИС (СИО)';
COMMENT ON COLUMN public.data_production.produceddate IS 'Дата производства';
COMMENT ON COLUMN public.data_production.alc_code IS 'Код продукции';
COMMENT ON COLUMN public.data_production.vbs IS 'Объем в дал. в безводном спирте';
COMMENT ON COLUMN public.data_production.volume_dal IS 'Объем в дал';
COMMENT ON COLUMN public.data_production.bottlecount IS 'Количество бутылок';

-- Foreign key comments

COMMENT ON CONSTRAINT data_production_nsi_clients_fk ON public.data_production IS 'Производитель';
COMMENT ON CONSTRAINT data_production_nsi_products_fk ON public.data_production IS 'Продукция';